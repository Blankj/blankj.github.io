# AucFrame 之让你的 Gradle 更智能

## 环境
首先来明确下开发环境，这里推荐使用 Android Studio 3.5-Beta4 及以上的版本，3.3.x 和 3.4.x 也都是可以的，只是没有智能提示，3.2.x 及以下版本的话就不推荐使用了，否则后面的课程可能会出问题。

## 背景
如果你开发过稍微大型点的项目，项目中肯定会存有多个 module，那么多个 gradle 的管理便成了问题，曾经我也分享过 [Android 开发之版本统一规范](https://blankj.com/2016/09/21/android-keep-version-unity) 这样的 ext 管理方式，但在 gradle 中没有智能提示，也不能跳转到这些变量，局限性太高是个硬伤，那么现在有更好的解决方案吗？答案是肯定的，就是利用 `buildSrc` 来更好地管理 Gradle。


## 解决方案
首先声明下，该方式在 AS 的 3.3.x 版本以及 3.4.x 版本是不能提供智能提示，推荐使用 3.5-Beta4 及以上的版本，相关 bug 地址传送门：https://issuetracker.google.com/issues/123032843，从修复  bug 这里可以看出 AS 团队也是赞成使用的，最新的 3.5 正式版相信马上就会到来了，我如今使用的版本是 3.5-Beta5 版本，一切如斯顺畅，效果图如下所示：

![提示效果图](./art/tip.jpg)

那么具体怎么操作呢，现在来揭晓其真面目，写过插件的肯定知道 `buildSrc` 这个目录，这个目录存在于项目根目录下，例如我这里就是 `AucFrameTemplate/buildSrc`，提醒一下，这个是要**自己创建**的哦，它默认是直接会参与编译，所以不用加入到 `setting.gradle` 中，具体如下图所示：

![buildSrc](./art/buildSrc.png)

下面我们自己来建立它，首先是 `.gitignore`，这个文件没什么好说的，内容就是 `/build`。

其 `build.gradle` 文件如下所示：

```groovy
repositories {
    google()
    jcenter()
}

apply {
    plugin 'groovy'
    plugin 'java-gradle-plugin'
}

dependencies {
    implementation gradleApi()
    implementation localGroovy()
    implementation "commons-io:commons-io:2.6"
}
```

加完这两文件后 `sync` 下项目后便可以看到 `buildSrc` 目录下生成了 `buildSrc.iml`，这就代表 `buildSrc` 已经参与到项目编译中了。

接下来我们在 `buildSrc/src/main/groovy` 中创建 `Config.groovy` 文件，向其中写入如下内容（根据项目自己修改）：

```groovy
class Config {

    static applicationId = 'com.blankj.aucframe'            // TODO: MODIFY
    static appName = 'AucFrame'                             // TODO: MODIFY

    static compileSdkVersion = 27                           // TODO: MODIFY
    static minSdkVersion = 21                               // TODO: MODIFY
    static targetSdkVersion = 27                            // TODO: MODIFY
    static versionCode = 1_000_000                          // TODO: MODIFY
    static versionName = '1.0.0'// E.g. 1.9.72 => 1,009,072 // TODO: MODIFY
}
```

写完后我们再同步一下项目，现在你可以跳转到 app 中的 `build.gradle` 中，设置你所需要设置的属性即可，可设置成如下所示：

```groovy
android {
    compileSdkVersion Config.compileSdkVersion
    defaultConfig {
        minSdkVersion Config.minSdkVersion
        versionCode Config.versionCode
        versionName Config.versionName
        applicationId Config.applicationId
        targetSdkVersion Config.targetSdkVersion
    }
}
```

你会发现在输入过程中是支持智能提示的，也可以支持跳转，如上只是基本的操作，愣着干嘛啊，赶紧扣 6 吧，接下来我们做更刺激的操作。